<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Kiá»ƒm tra thiáº¿t bá»‹</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; background: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        .info { background: #eef2ff; padding: 10px; border-radius: 5px; border-left: 5px solid #1e40af; margin-bottom: 10px; word-break: break-all; }
        .status-ok { color: green; font-weight: bold; }
        .status-err { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ” Kiá»ƒm tra thÃ´ng tin mÃ¡y</h2>
    
    <div id="auth-status">Äang kiá»ƒm tra Ä‘Äƒng nháº­p...</div>
    <hr>
    
    <p><strong>ID thiáº¿t bá»‹ cá»§a mÃ¡y nÃ y:</strong></p>
    <div id="device-id" class="info">Äang láº¥y ID...</div>

    <p><strong>TÃªn thiáº¿t bá»‹ (nháº­n diá»‡n):</strong></p>
    <div id="device-name" class="info">Äang nháº­n diá»‡n...</div>

    <div id="db-status"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Cáº¥u hÃ¬nh cá»§a báº¡n
    const firebaseConfig = {
        apiKey: "AIzaSyALblbqW_VrZh2r7sPJ8Q6XT2fGbk0dsFg",
        authDomain: "donghung-3208d.firebaseapp.com",
        projectId: "donghung-3208d",
        storageBucket: "donghung-3208d.firebasestorage.app",
        messagingSenderId: "753379492663",
        appId: "1:753379492663:web:baff34f2c0bac00e02d0b2"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // 1. Láº¥y ID tá»« LocalStorage
    const currentId = localStorage.getItem('my_device_id');
    document.getElementById('device-id').innerText = currentId || "ChÆ°a cÃ³ ID (HÃ£y Ä‘Äƒng nháº­p táº¡i login.html trÆ°á»›c)";

    // 2. Nháº­n diá»‡n tÃªn mÃ¡y
    const ua = navigator.userAgent;
    let name = "Thiáº¿t bá»‹ láº¡";
    if (ua.includes("Windows")) name = "Windows PC";
    else if (ua.includes("iPhone")) name = "iPhone";
    else if (ua.includes("Android")) name = "Äiá»‡n thoáº¡i Android";
    document.getElementById('device-name').innerText = name;

    // 3. Kiá»ƒm tra káº¿t ná»‘i Firebase
    onAuthStateChanged(auth, async (user) => {
        const authStatus = document.getElementById('auth-status');
        const dbStatus = document.getElementById('db-status');

        if (user) {
            authStatus.innerHTML = `Tráº¡ng thÃ¡i: <span class="status-ok">ÄÃ£ Ä‘Äƒng nháº­p</span><br>Email: ${user.email}`;
            
            try {
                // Thá»­ Ä‘á»c dá»¯ liá»‡u cá»§a chÃ­nh mÃ¬nh Ä‘á»ƒ xem Rules cÃ³ cháº¡y khÃ´ng
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    dbStatus.innerHTML = `<span class="status-ok">âœ… ÄÃ£ káº¿t ná»‘i Database thÃ nh cÃ´ng!</span>`;
                    console.log("Dá»¯ liá»‡u trÃªn Server:", userDoc.data());
                } else {
                    dbStatus.innerHTML = `<span class="status-err">âŒ ÄÄƒng nháº­p OK nhÆ°ng chÆ°a cÃ³ há»“ sÆ¡ trÃªn Firestore.</span>`;
                }
            } catch (e) {
                dbStatus.innerHTML = `<span class="status-err">âŒ Lá»—i Rules: ${e.message}</span>`;
            }
        } else {
            authStatus.innerHTML = `Tráº¡ng thÃ¡i: <span class="status-err">ChÆ°a Ä‘Äƒng nháº­p</span>`;
            dbStatus.innerHTML = `<a href="login.html">Äáº¿n trang ÄÄƒng nháº­p</a>`;
        }
    });
</script>
</body>
</html>
